# ED2K链接净化器

一个强大的在线工具，用于从混乱的文本中提取并净化ED2K下载链接。

## 🚀 功能特性

- **智能识别**：自动识别各种格式的ED2K链接
- **全面净化**：清理HTML标签、干扰词、URL编码等杂质
- **实时统计**：显示有效链接数、修复数等详细信息
- **一键复制**：方便快速复制净化后的链接
- **用户友好**：简洁美观的界面设计

## 🆕 最近更新 (Latest Updates)

### v1.1.0 - 体验与解析能力升级 (2025-12-04)

#### 🖥️ 用户界面与体验 (UI/UX)
- **透明毛玻璃 Toast 提示**：
  - 采用现代化的透明毛玻璃效果 (`backdrop-filter`)，配合状态色（绿/红/橙）。
  - 使用高清 SVG 图标（对勾、叉号、感叹号），去除了不统一的 Emoji。
  - 支持多 Toast 堆叠显示，拥有独立的生命周期和优雅的进出场动画。
- **智能输入框**：
  - **自动换行**：输入框失去焦点或页面切换到后台时，自动在末尾添加换行符，方便连续批量复制粘贴。
  - **自动滚动与留白**：输入/粘贴内容或失去焦点时，自动滚动到底部；底部预留 50px 空白，防止文字被边框遮挡。
- **复制按钮优化**：
  - 仅在有结果时启用，文案简化为"复制"。
  - 优先使用标准 Clipboard API，并提供稳健的降级方案（隐藏 textarea 模拟复制），确保全平台兼容。
- **全离线支持**：移除所有在线资源引用（字体、图标），确保断网环境下功能完全正常。

#### ⚙️ 核心解析逻辑增强 (Core Logic)
- **断裂协议头修复**：
  - 自动识别并合并因换行符导致的协议头断裂（例如修复 `ed2 \n k://` 为 `ed2k://`）。
- **粘连链接分离**：
  - 智能检测并分离紧密相连的链接（如 `...|/ed2k://...`）。
  - 支持识别仅用 `|` 分隔或 URL 编码 (`%7C`) 分隔的粘连情况。
- **全角字符清理**：
  - 增强了协议头清洗正则，支持移除全角字符（如中文括号 `（）`），解决了 `ed2k（删除我）://` 无法解析的问题。

---

## 📋 支持的链接格式

- HTML标签包裹的链接：`<p>ed2k://...</p>`
- 包含干扰词的链接：`ed2k删除://...`
- URL编码的链接：`ed2k://%7Cfile%7C...`
- 各种协议变形和格式不规范的链接

## 🔍 核心解析逻辑

本工具采用多阶段处理流程来确保最大程度提取有效链接：

1. **预处理 (Pre-processing)**
   - **修复断裂协议头**：自动合并因换行或空格导致的协议头断裂（如 `ed2 \n k://`）。
   - **分离粘连链接**：智能识别并分离紧密排列的多个链接（支持 `|/ed2k:`、`|ed2k:` 及其 URL 编码形式）。

2. **智能提取 (Extraction)**
   - 采用多组正则表达式提取潜在链接，支持：
     - 标准格式 (`ed2k://...`)
     - 模糊协议 (`e...d...2...k...://`)
     - URL 编码格式
     - 包含 HTML 标签的片段
     - 缺失协议头的片段 (`|file|...`)

3. **深度净化 (Purification)**
   - **HTML 清理**：移除包裹链接的 HTML 标签。
   - **URL 解码**：自动识别并解码 URL 编码字符。
   - **协议头清洗**：移除协议头中的干扰字符，支持去除中文、全角符号（如 `（）`）、乱码等。
   - **格式规范化**：补全缺失的 `ed2k://` 前缀，修正空格，确保以 `/` 结尾。

4. **严格校验 (Validation)**
   - 最终链接必须符合 ED2K 标准格式：`ed2k://|file|文件名|大小|哈希值|...|/`

## 🎯 使用方法

1. 在输入框中粘贴包含ED2K链接的文本
2. 点击"净化链接"按钮
3. 在输出框中查看清理后的纯净链接
4. 使用"复制结果"按钮一键复制所有链接

## 💡 示例

**输入：**
```
<p>ed2k://|file|example_video.mp4|1234567890|ABC123DEF456789012345678901234567890|/</p>
ed2k删除://|file|sample_file.mp4|9876543210|DEF456ABC789012345678901234567890123|h=XYZABC123DEFGHI456JKLMNO789PQRSTUV|/
ed2k://%7Cfile%7C%20demo_content.mp4%7C1357924680%7CGHI789JKL012345678901234567890ABCDEF%7Ch=MNOPQR456STUVWX789ABCDEF012345GHIJK%7C/
```

**输出：**
```
ed2k://|file|example_video.mp4|1234567890|ABC123DEF456789012345678901234567890|/
ed2k://|file|sample_file.mp4|9876543210|DEF456ABC789012345678901234567890123|h=XYZABC123DEFGHI456JKLMNO789PQRSTUV|/
ed2k://|file| demo_content.mp4|1357924680|GHI789JKL012345678901234567890ABCDEF|h=MNOPQR456STUVWX789ABCDEF012345GHIJK|/
```

## 🛠️ 技术实现

- 纯HTML/CSS/JavaScript实现，无需服务器
- 智能正则表达式匹配和文本处理
- 响应式设计，支持各种设备
- 本地运行，数据安全可靠

## 🚀 快速开始

1. 克隆仓库：
   ```bash
   git clone https://github.com/socks1s/ed2k.git
   ```

2. 在浏览器中打开 `index.html` 文件即可使用

3. 或者使用本地服务器：
   ```bash
   python3 -m http.server 8080
   ```
   然后访问 `http://localhost:8080`

## 📁 项目结构

```
ed2k/
├── index.html               # 主要工具页面
├── README.md                 # 项目说明文档
└── .gitignore               # Git忽略文件
```

## ⌨️ 键盘快捷键

- `Ctrl + Enter`：净化链接
- `Ctrl + R`：清空所有内容

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个工具！

---

💡 **提示**：这个工具完全在本地运行，不会上传您的数据到任何服务器，保证隐私安全。
